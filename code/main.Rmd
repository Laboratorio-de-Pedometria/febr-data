---
output: html_document
---

```{r}
library(magrittr)
library(glue)
library(googlesheets)
library(rgdal)
library(gdalUtils)
```

Descarregar a planilha `febr-chaves` contendo as chaves de identificação das tabelas dos conjuntos de dados
publicados no ___febr___.

```{r}
key <- "18yP9Hpp8oMdbGsf6cVu4vkDv-Dj-j5gjEFgEXN-5H-Q"
sheets_keys <- try(gs_key(key) %>% gs_read_csv(), TRUE)
if (class(sheets_keys)[1] == "try-error") {
  url <- glue::glue("https://docs.google.com/spreadsheets/d/{key}/export?format=csv")
  tempfile <- tempfile(fileext = "cvs")
  download.file(url, destfile = tempfile)
  sheets_keys <- readr::read_csv(tempfile)
}
save(sheets_keys, file = "../data/febr-chaves.rda")
```

## Tabelas `dataset`

```{r}
dts <- febr::dataset(dataset = 'all')
save(dts, file = "../data/dts.rda")
```

## Tabelas `observacao`

```{r}
obs <- febr::observation(
  dataset = 'all', variable = "coord_descricao", 
  standardization = list(crs = "EPSG:4674", time.format = "%d-%m-%Y"))
save(obs, file = "../data/obs.rda")
```

## Tabelas `camada`

```{r}
lyr <- febr::layer(
  dataset = "all", 
  standardization = list(plus.sign = "remove", transition = "smooth"))
save(lyr, file = "../data/lyr.rda")
```

## Estados brasileiros

Descarregar a planilha `febr-estados` contendo as siglas e nomes dos estados brasileiros.

```{r}
uf <-
  gs_key('1bTIcFLpnOefYs_BaegPC59kbF3gEugOXpYpnfyrDsDQ') %>% 
  gs_read_csv(verbose = FALSE)
save(uf, file = '../data/uf.rda')
```

Descarregar arquivo vetorial contendo os limites das unidades federativas brasileiras. A fonte dos dados é o
Instituto Nacional de Geografia e Estatística.

```{r}
if (!file.exists("../data/br.shp")) {
  # http://www.geoservicos.ibge.gov.br/geoserver/wfs?service=wfs&version=1.1.0&request=GetCapabilities
  dsn <- "WFS:http://www.geoservicos.ibge.gov.br:80/geoserver/wfs"
  br <- readOGR(dsn = dsn, layer = "CGEO:C02_limite_estadual_2010")
  raster::shapefile(br, filename = "../data/br.shp")
}
```

